<html>
<head>
  <title>A D3 map</title>
  <script src='https://d3js.org/d3.v4.min.js'></script>
  <script src='tooltip.js'></script>
  <style type="text/css">
    .tooltip{ background-color:rgba(68,136,187,0.5);;
          margin: 10px;
          height: 50px;
          width: 150px;
          padding-left: 10px; 
          padding-top: 10px;
    -webkit-border-radius:10px;
    -moz-border-radius:10px;
    border-radius:10px;
        }
  </style>
</head>
<body>
  <script>
var width = 900,
    height = 900;

var svg = d3.select('body')
  .append('svg')
  .attr('width', width)
  .attr('height', height);

var g = svg.append('g');

var projection = d3.geoMercator()
    .scale(18000)
    .center([-8, 42.8])
    .translate([width / 2, height / 2]);

var geoPath = d3.geoPath()
    .projection(projection)
    .pointRadius(2);

d3.json("galicia_concellos_areas.json", function(error, data) {
  g.selectAll('path')
    .data(data.features)
    .enter()
    .append('path')
    .attr('fill', (d)=> {
      if(d.properties.population == '-'){
        return '#fff';
      }
      if(populationBetween(d.properties.population, null, 2000)) {
        return '#ccc';
      } else if(populationBetween(d.properties.population, 2000, 5000)) {
        return '#bbb';
      } else if(populationBetween(d.properties.population, 5000, 10000)) {
        return '#aaa';
      } else if(populationBetween(d.properties.population, 10000, 20000)) {
        return '#888';
      } else if(populationBetween(d.properties.population, 20000, 50000)) {
        return '#777';
      } else if(populationBetween(d.properties.population, 50000, 100000)) {
        return '#666';
      } else if(populationBetween(d.properties.population, 100000, null)) {
        return '#555';
      }
    })
    .attr('d', geoPath)
    .on( "click", function(d){
      console.log(d);
    })
    .call(d3.helper.tooltip(
        function(d, i){
          return "<b>"+d.properties.name + "</b><br/>habitantes: "+d.properties.population;
        }
        ));
});


var points = svg.append('g');

d3.json("galicia_concellos_points.json", function(error, data) {
  points.selectAll('path')
  .data(data.features)
  .enter()
  .append('path')
  .attr('fill', '#000')
  .attr('stroke', '#000')
  .attr('d', geoPath);
});

/*points.selectAll('path')
  .data(galicia_points_json.features)
  .enter()
  .append('path')
  .attr('fill', '#000')
  .attr('stroke', '#000')
  .attr('d', geoPath);*/

function populationBetween(population, min, max){
  if(min == null)
    return population < max;
  if(max == null)
    return population > min;
  return population >= min && population < max;
}

  </script>
</body>
</html>